name: Full PHP Quality Analysis

env:
  PROJETO: CALCULADORA-PHP

on:
  push:
    branches: [ "main" ]
  pull_request:

jobs:

  # ============================================================
  # JOB 1 — SONARQUBE V01
  # ============================================================
  sonarqubeCloud:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Instalar PHP e dependências do Composer
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.4'
          coverage: xdebug   # ativa cobertura
          extensions: mbstring

      - name: Instalar dependências
        run: composer install --no-interaction --prefer-dist

      #- name: Rodar testes com cobertura
      #  run: |
      #    php vendor/bin/phpunit --coverage-clover coverage.xml

      - name: Sonar Scanner CLI
        uses: SonarSource/sonarqube-scan-action@v5
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        with:
          args: >
            -Dsonar.organization=Gabriel Moreira
            -Dsonar.projectKey=gabriel-jmoreira_calculadora-php
            -Dsonar.host.url=https://sonarcloud.io
            -Dsonar.sources=src
            -Dsonar.tests=tests
            -Dsonar.php.coverage.reportPaths=coverage.xml
            -Dsonar.coverage.exclusions=src/Operacoes/Dividir.php,src/Operacoes/Multiplicar.php,src/Operacoes/Somar.php,src/Operacoes/Subtrair.php
            